<div class="container-fluid" ng-controller="invoiceCtrl">

    <!--page name-->
    <div class="row">
        <div class="col-12 h4">Список заказов</div>
    </div>

    <!--main content for this page-->
    <div class="row">

        <!--invoices-short section -->
        <div class="container invoice__field col-lg-3">

            <!--control\filters-->
            <div class="row">
                <!--<input type="text" placeholder="Фильтровать по всем полям" ng-model="orderNumber">-->
                <input class="col-12"
                       title="введите №заказа"
                       type="text"
                       placeholder="Фильтровать по номеру заказа"
                       ng-model="fltr.ordernumber">

                <input type="checkbox" checked data-toggle="toggle">
            </div>

            <!--invoice short card-->

            <div class="row invoice__card__short"
                 ng-repeat="invoice in InvoiceList | filter: fltr"
                 ng-click="prepareToEditInvoice(invoice)">

                <div class="col-12 col-lg-11">
                    <span class="h6">{{invoice.ordernumber}}</span>

                    <span>{{invoice.comment}}</span>

                    <span>сумма: {{invoice.totalprice | isEmpty }} р.</span>

                    <span>создан: {{invoice.datacreate | date: "yyyy.MM.dd" | isEmpty }}</span>

                    <!--                        <span>выполнен: {{invoice.resolveddate | isEmpty }}</span>-->
                    <span>выполнен: {{invoice.resolveddate | date: "yyyy.MM.dd" | isEmpty }}</span>
                    <!--                        <span>выполнен: {{invoice.resolveddate}}</span>-->
                </div>

                <div class="col-12 col-lg-1 {{isWarning(invoice.resolveddate)}}"></div>

            </div>

        </div>

        <!--invoice details-->
        <div class="container col-lg-9">
            <div class="row h4">Детали заказа заказа {{invoiceJSON.ordernumber}}</div>

            <!--invoice details ----- вывод основных значений-->
            <div class="row invoice__main">

                <form class="col was-validated">

                    <button class="btn btn-outline-success col-12"
                            data-toggle="modal"
                            data-target="#editInvoiceModal"
                            type="button">Сохранить изменения
                    </button>

                    <!--1c код \ Отдел \ Согласователь-->
                    <div class="form-row">

                        <!--iD скрыто-->
                        <input hidden placeholder="id" type="number" ng-model=invoiceJSON.id>

                        <!--1c код-->
                        <div class="col-md-4">
                            <label for="orderNumber1c">Заказ (1c код)</label>
                            <input class="form-control is-valid"
                                   id="orderNumber1c"
                                   type="text"
                                   ng-model=invoiceJSON.ordernumber
                                   placeholder="заполнить номер заказа из 1с"
                                   required>
                            <div class="invalid-feedback"> <!--поменять на class="valid-feedback" когда заполнено-->
                                Укажите код заказа из 1с.
                            </div>
                        </div>

                        <!--Отдел-->
                        <div class="col-md-4">
                            <label for="validationServer03">Отдел</label>
                            <select class="form-control custom-select is-valid"
                                    id="validationServer03"
                                    ng-model=invoiceJSON.department
                                    required>
                                <option value="{{invoiceJSON.department}}" selected="selected">
                                    ...({{invoiceJSON.department}})
                                </option>
                                <option value="FRAC (PL_215)">FRAC (PL_215)</option>
                                <option value="COIL (PL_214)">COIL (PL_214)</option>
                                <option value="DRT">DRT</option>
                                <option value="General_C">General_C</option>
                            </select>
                            <div class="invalid-feedback">
                                укажите центр затрат (отдел).
                            </div>
                        </div>

                        <!--                        &lt;!&ndash;Согласователь todo не работает выбор согласователя&ndash;&gt;
                                                <div class="col-md-4" ng-controller="customerCtrl">
                                                    <label for="validationApprover">Согласователь</label>
                                                    <select class="form-control custom-select is-valid"
                                                            id="validationApprover"
                                                            ng-model=invoiceJSON.customer
                                                            required>
                                                        <option value="{{invoiceJSON.customer.id}}" selected="selected">
                                                            {{invoiceJSON.customer.login}}
                                                        </option>
                                                        <option ng-repeat="customer in customerList"
                                                                value="{{customer.id}}"
                                                                ng-model="customer.login">{{customer.login}}
                                                        </option>
                                                    </select>
                                                    <div class="invalid-feedback">
                                                        укажите руководителя подразделения.
                                                    </div>
                                                </div>-->

                    </div>

                    <!--Описание заказа-->
                    <div class="form-row">
                        <!--Описание заказа-->
                        <div class="col-md-12">
                            <label for="validationOrderInfoShort">Описание заказа</label>
                            <input type="text"
                                   class="form-control is-valid"
                                   id="validationOrderInfoShort"
                                   ng-model=invoiceJSON.comment
                                   placeholder="заполнить короткое описание заказа"
                                   required>
                            <div class="invalid-feedback">
                                введите короткое описание заказа.
                            </div>
                        </div>
                    </div>

                    <!--сумма заказа \ № СФ-->
                    <div class="form-row">

                        <!--сумма заказа-->
                        <div class="col-md-6">
                            <label for="totalPrice">Сумма заказа</label>
                            <input type="number"
                                   class="form-control"
                                   id="totalPrice"
                                   ng-model=invoiceJSON.totalprice
                                   placeholder="заполнить сумму заказа xx,00">
                        </div>

                        <!--№ СФ-->
                        <div class="col-md-6">
                            <label for="validationServer05">№СФ</label>
                            <input type="text"
                                   class="form-control"
                                   id="validationServer05"
                                   ng-model=invoiceJSON.invoicenumber
                                   placeholder="заполнить номер СФ">
                        </div>

                    </div>

                    <!--                    &lt;!&ndash; на расценке \ на согласовании \ закупается&ndash;&gt;
                                        <div class="form-row cb_border">

                                            &lt;!&ndash;На расценке&ndash;&gt;
                                            <div class="form-check col-md-4">
                                                <input class="form-check-input"
                                                       type="checkbox"
                                                       id="Check01"
                                                       ng-model=invoiceJSON.senttoprice>
                                                <label class="form-check-label" for="Check01"> На расценке </label>
                                            </div>

                                            &lt;!&ndash;на согласовании&ndash;&gt;
                                            <div class="form-check col-md-4">
                                                <input class="form-check-input"
                                                       type="checkbox"
                                                       id="Check02"
                                                       ng-model=invoiceJSON.senttoapprove>
                                                <label class="form-check-label" for="Check02">На согласовании</label>
                                            </div>

                                            &lt;!&ndash;Закупается&ndash;&gt;
                                            <div class="form-check col-md-4">
                                                <input class="form-check-input"
                                                       type="checkbox"
                                                       id="Check03"
                                                       ng-model=invoiceJSON.senttopurchase>
                                                <label class="form-check-label"
                                                       for="Check03">Закупается</label>
                                            </div>

                                        </div>-->

                    <div class="form-row">
                        <!--дата создания заказа-->
                        <div class="col-md-6">
                            <label for="validationDataCreate">Дата создания заказа</label>
                            <input type="date" disabled
                                   class="form-control is-valid"
                                   id="validationDataCreate"
                                   ng-value="invoiceJSON.datacreate | date: 'yyyy-MM-dd' | isEmpty">
                            <!--ng-model=invoiceJSON.datacreate-->
                        </div>

                        <!--дата закрытия\выполнения заказа-->
                        <div class="col-md-6">
                            <label for="validationDataResolve">Дата выполнения заказа</label>
                            <input type="date" disabled
                                   class="form-control is-valid"
                                   id="validationDataResolve"
                                   ng-value="invoiceJSON.resolveddate | date: 'yyyy-MM-dd' | isEmpty"
                                   ng-model=invoiceJSON.resolveddate>
                        </div>
                    </div>

                </form>

            </div>

            <!--invoice elements-->

            <div class="row h4">
                Список товаров в заказе:
            </div>

            <div class="row">
                <div class="col-12">
                    <div class="invoice__element" ng-repeat="purchase in invoiceJSON.purchases">
                        <div class="container-fluid">
                            <div class="row">

                                <!--товар\описаниеТовара-->
                                <div class="col-lg-5 ">
                                    <div class="h6">
                                        {{purchase.nomenclature.nomenclature}}
                                        ({{purchase.nomenclature.code | isEmpty }})
                                    </div>
                                    <div>{{purchase.nomenclature.comment | isEmpty }}</div>
                                    <div>{{purchase.buyingPrice | currency: "Ꝑ" : 2 | isEmpty }}</div>
                                    <div>{{purchase.commentnumenclature | currency: "Ꝑ" : 2 | isEmpty }}</div>
                                </div>

                                <!--для кого -->
                                <div class="col-lg-4">
                                    <div> {{purchase.comment | isEmpty }}</div>
                                </div>

                                <!--количество \ датаПолучения-->
                                <div class="col-lg-3">
                                    <div class="container">
                                        <div class="row">
                                            <div class="col-lg-4"> {{purchase.count | isEmpty }} шт.</div>
                                            <div class="col-lg-6 {{isWarning(purchase.resolvingdate)}}">
                                                {{purchase.resolvingdate | date: "yyyy.MM.dd" | unachieved }}
                                            </div>
                                            <div class="col-lg-2">
                                                <button class="btn btn-sm text-center btn-outline-danger"
                                                        ng-click="deletePurchaseFromInvoice($index)">Ⓧ
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!--            &lt;!&ndash;<button ng-click="deleteNomenclature(invoiceJSON)">Удалить</button>&ndash;&gt;
                        <button class="row btn text-center btn-outline-danger col-12"
                                data-toggle="modal"
                                data-target="#deleteInvoiceModal"
                                type="button">
                            Удалить заказ Ⓧ
                        </button>-->

        </div>

        <!--works steps   Это не нужно - сделать ниже основной части заказов-->
        <!--
                <div class="col-lg-2">

                    <div ng-repeat="invoice in InvoiceList | filter:orderNumber">

                        <h4>Этапы выполнения:</h4>

                        &lt;!&ndash;на расценке&ndash;&gt;
                        <select class="form-control {{isTrueClass(invoice.senttoprice)}}"
                                ng-model="invoice.senttoprice" ng-value=invoice.senttoprice disabled>
                            <option ng-value=invoice.senttoprice selected="selected">
                                {{isPriced(invoice.senttoprice)}}
                            </option>
                            <option class="bg-success" ng-value="true">цена предоставлена</option>
                            <option class="bg-warning" ng-value="false">цена не предоставлена</option>
                        </select>

                        &lt;!&ndash;на согласовании &ndash;&gt;
                        <select class="form-control {{isTrueClass(invoice.senttoapprove)}}"
                                ng-model="invoice.senttoapprove" ng-value=invoice.senttoapprove disabled>
                            <option ng-value=invoice.senttoapprove selected="selected">
                                {{isApproved(invoice.senttoapprove)}}
                            </option>
                            <option class="bg-success" ng-value="true">согласован</option>
                            <option class="bg-warning" ng-value="false">на согласовании</option>
                        </select>

                        &lt;!&ndash;закупается&ndash;&gt;
                        <select class="form-control {{isTrueClass(invoice.senttopurchase)}}"
                                ng-model="invoice.senttopurchase" ng-value=invoice.senttopurchase disabled>
                            <option ng-value=invoice.senttopurchase selected="selected">
                                {{isPurchased(invoice.senttopurchase)}}
                            </option>
                            <option class="bg-success" ng-value="true">закупается</option>
                            <option class="bg-warning" ng-value="false">ожидает закупки</option>
                        </select>

                        <p class="col-sm-12" title="...">Внутренняя логистика</p>

                        <p class="col-sm-12" title="...">Хранение</p>

                        <p class="col-sm-12" title="...">Доставка заказчику</p>

                        <p class="col-sm-12" title="...">Принят заказчиком</p>

                        &lt;!&ndash;СФ номер&ndash;&gt;
                        <div class="input-group mb-3">

                            <div class="input-group-prepend">
                                <div class="input-group-text {{isTableWarning(invoice.invoicenumber)}}">
                                    <input class=""
                                           type="checkbox"
                                           disabled
                                           ng-model="invoice.invoicenumber">
                                </div>
                            </div>

                            <input type="text"
                                   disabled
                                   class="form-control {{isTableWarning(invoice.invoicenumber)}}"
                                   placeholder="СФ номер {{invoice.invoicenumber}} "
                                   ng-model="invoice.invoicenumber">

                        </div>

                        <p class="col-sm-12" title="...">СФ отправлено (№ трекинга почты)</p>

                        <p class="col-sm-12" title="...">Счет оплачен</p>

                    </div>

                </div>
        -->

    </div>

    <!-- Modal Edit invoice -->
    <div class="modal fade"
         id="editInvoiceModal"
         tabindex="-1" role="dialog"
         aria-labelledby="editInvoiceModalLabel"
         aria-hidden="true">

        <div class="modal-dialog">
            <div class="modal-content">

                <div class="modal-header">

                    <h5 class="modal-title"
                        id="editInvoiceModalLabel">Сохранить изменения в заказе?</h5>

                    <button type="button"
                            class="close"
                            data-dismiss="modal"
                            aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>

                </div>

                <div class="modal-body">
                    <h4>{{invoiceJSON.ordernumber}}</h4>
                    <p>{{invoiceJSON.comment}}</p>
                    <p>{{invoiceJSON.department}}</p>
                    <p>{{invoiceJSON.customer.firstName}} {{invoiceJSON.customer.lastName}}</p>
                    <p>{{invoiceJSON.totalprice}}</p>
                    <p>{{invoiceJSON.datacreate}}</p>
                </div>

                <div class="modal-footer">

                    <button type="button"
                            class="btn btn-primary"
                            ng-click="editInvoice($scope.invoiceJSON)">Сохранить
                    </button>

                    <button type="button"
                            class="btn btn-secondary"
                            data-dismiss="modal">Отменить
                    </button>

                </div>
            </div>
        </div>
    </div>

    <!-- Modal Delete invoice from DB -->
    <div class="modal fade"
         id="deleteInvoiceModal"
         tabindex="-1" role="dialog"
         aria-labelledby="deleteInvoiceModalLabel"
         aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">

                <div class="modal-header">

                    <h5 class="modal-title"
                        id="deleteInvoiceModalLabel">Удалить весь заказ из БД навсегда?</h5>

                    <button type="button"
                            class="close"
                            data-dismiss="modal"
                            aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>

                </div>

                <div class="modal-body">
                    <h4>{{invoiceJSON.ordernumber}}</h4>
                    <p>{{invoiceJSON.comment}}</p>
                    <p>{{invoiceJSON.department}}</p>
                    <p>{{invoiceJSON.customer.firstName}} {{invoiceJSON.customer.lastName}}</p>
                    <p>{{invoiceJSON.datacreate}}</p>
                </div>

                <div class="modal-footer">

                    <button type="button"
                            class="btn btn-primary"
                            ng-click="deleteInvoice(invoice)">Удалить
                    </button>

                    <button type="button"
                            class="btn btn-secondary"
                            data-dismiss="modal">Отменить

                    </button>

                </div>
            </div>
        </div>
    </div>

</div>


